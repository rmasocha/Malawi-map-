<!DOCTYPE html>
<html lang='en'>

<head>
  <title>Labor Migration from Malawi to South Africa and Zimbabwe: 1904-1950</title>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link href='https://api.mapbox.com/mapbox-assembly/v0.8.0/assembly.min.css' rel='stylesheet'>
  <link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cardo&display=swap" rel="stylesheet">

  <style>
    h1 {
      font-family: 'Montserrat', sans-serif;
      font-size: 20px;
      color: #67271d;
    }

    h2 {
      font-family: 'Montserrat', sans-serif;
      font-size: 18px;
      color: #67271d;
    }

    h3 {
      font-family: 'Montserrat', serif;
      font-size: 12px;
    }

    h4 {
      font-family: 'Montserrat', serif;
      font-size: 12px;
    }

    h5 {
      font-family: 'Cardo', serif;
      font-size: 12px;
    }

    #scroll {
      background-image: url(images/fresh_snow.png); /* add subtle pattern to background from (https://www.toptal.com/designers/subtlepatterns/fresh-snow/) */
    }

    /* Set time slider styles */
    #slider {
      position: absolute;
      height: 25px;
      bottom: 0px;
      left: 125px;
      z-index: 1000;
      background-color: #FFFFFF;
      border-radius: 3px;
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
    }

    /* Set temporal legend styles */
    #temporal {
      height: 25px;
      background-color: #FFFFFF;
      border-radius: 3px;
      box-shadow: 0px 0px 0px 2px rgba(0, 0, 0, 0.3);
    }

    /* Set the styles for the text span in the temporal legend */
    #temporal span {
      position: absolute;
      bottom: 3px;
      left: 10px;
    }

    /* Migration arrow layer button styles */
    #event {
      position: absolute;
      top: 50px;
      right: 300px;
      height: 100px;
      width: 400px;
      z-index: 10000;
    }

    .btn {
      font: 12px 'Montserrat', sans-serif;
      color: black;
      background-color: white;
      padding: 5px;
      border: 1px solid transparent;
      border-radius: 2px;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      outline: none;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      alignment-baseline: central;
      right: 12px;
      top: 55px;
      text-align: center;
      text-decoration: none;
      margin: 0px auto;
    }

    .btn:hover {
      background-color: #f9f9f9;
    }

    hr.small,
    hr.large {
      width: 80px;
      position: absolute;
      top: -9px;
      left: 62px;
      border: 1px solid #ccc;
      /* overwrite assembly.css rule */
      margin-top: 8px;
      /* overwrite assembly.css rule */
    }
  </style>

</head>

<body>
  <div class='grid'>
    <div class='col col--12 col--3-ml p12 pb6 viewport-third viewport-full-ml'>
      <div id='scroll' class='h-full scroll-auto'>
        <h1 class='txt-subhead mb6'>Labor Migration from Malawi to South Africa and Zimbabwe: 1904-1950</h1>
        <h5>This map presents the labor migration flow for migrants from Malawi going to work in South Africa and Zimbabwe between the years 1904 and 1950. The map visualizes numerous factors intersecting together in shaping migration patterns and
          captures the complexity of understanding migration patterns in Southern Africa. Firstly, there were legal and illegal ways that migrants traveled from Malawi to other countries [1]. Secondly, several ethnicities share common backgrounds and
          are closely related who speak similar dialects sparse across Malawi, Zimbabwe, South Africa, and other parts of Southern Africa. Finally, several factors, such as disease and culture, shape the migration patterns. Thinking about migration
          networks and patterns through the labor migrant system of Southern Africa then begs the question of how to locate these patterns and network systems.</h5>
        <h2 class='txt-xl mt18 mb12'>Argument:</h2>
        <h5>The data visualization through mapping labor migration patterns does not only change the format of presenting information on migration in Southern Africa. Scholars analyze labor migration in colonial Africa, concentrating on routes
          developed by the colonial governments [2]. However, through the map, one begins to realize that there were existing routes used by Africans for trading and to connect their communities in Southern Africa even before colonial rule. The
          question the map raises is, how do these routes connect to colonial labor migration networks in Southern Africa? This map makes apparent the fact that there are so many ways to think about and interpret labor migration in Southern Africa.
          It encourages scholars to think and pay attention to those seemingly hidden routes knowledgeable to Africans, which they used to travel across southern Africa. These are the routes that enabled so many Africans to migrate successfully as
          undocumented from Malawi.</h5>
        <h2 class='txt-xl mt18 mb12'>Data Description:</h2>
        <h5>The map is based on data extracted from annual blue book statistics of the Nyasaland colony between 1904 and 1938. I accessed the Bluebooks on the British online archives <a class='link'
            href='https://microform.digital/boa/collections'>website</a>. From the Bluebooks, I got the annual immigration and emigration census data and total population percentages. The statistical data is supplemented by other data of the number
          of migrants working in Zimbabwe and South Africa between 1904 and 1950 extracted from the statistical index published in the book Labor Export Policy in the Development of Southern Africa by Bill Paton. The map has an ethnicity layer that
          overlays the political boundaries of southern Africa. Data for ethnic demarcations and the shapefile were found on the Harvard <a class='link' href='http://worldmap.harvard.edu/data/geonode:murdock_ea_2010_3'>website</a>. Because this map
          is based on colonial archival data of migration statistics, it misses accounting for the numerous migrants who used different routes that were not official and, therefore, never recorded by the colonial system. However, looking at the
          spread-out nature of ethnic groups and southern Africa over the demarcated colonial borders shows us that ethnic relations and connections in this part of Africa run across the colonial borders. Therefore, when we think about colonial
          migration networks, it would be worthwhile to focus on these instead of concentrating on colonial borders.</h5>
        <h2 class='txt-xl mt18 mb12'>References:</h2>
        <h5>[1] Bill Paton, Labor Export Policy in the development of Southern Africa, Macmillan Press Ltd,London, 1995, p.1-22.
          [2] Musoni Francis, Border Jumping and migration control in Southern Africa, Indiana University Press, Bloomington, 2020, p.8-12.</h5>
<!--
        <hr class='txt-hr'>
        <footer class='mt12 bg-gray-faint txt-s'>
          <ul>
            <li>Choropleth ranges are derived from the application of natural breaks (jenks) to the data representing each nation's share of the total volume of weapons sold between 2008 and 2018. This was modified to remove nations with no purchases from the bottom class.</li>
            <li>Explore the raw data: <a class='link' href='https://www.sipri.org/databases/armstransfers'>SIPRI Arms Transfers Database</a></li>
            <li>Map authored by <a class='link' href='https://geography.as.uky.edu/users/jebowe3'>Jay Bowen</a>, 2019</li>
          </ul>
        </footer>
-->
      </div>
      <!-- end scroll bar -->
    </div>
    <div class='col col--12 col--9-ml h180 h-full-ml'>
      <div id="map" class='viewport-twothirds viewport-full-ml'></div>

      <!-- ui slider -->
      <div id='slider' class='range w240 bg-white border border--gray-light round-ml p12'>
        <input type='range' min="1904" max="1950" value="1904" step="1" class="slider" />
      </div>
      <!-- end slider -->

      <!-- temporal legend -->
      <div id='temporal' class='py6 px48 bg-white border border--gray-light round bottom left wmax200'>
        <h3 class='txt-bold'><span></span></h3>
      </div>
      <!-- end temporal -->

      <!-- arrow buttons -->
      <div id='event'>
        <input type="button" value="hide arrows" class="btn" onclick="hide()">
        <input type="button" value="show arrows" class="btn" onclick="show()">
      </div>
      <!-- end end arrow buttons -->

      <!-- keeps map from jarring -->
      <div id="container" style="min-width: 310px; height: 400px; max-width: 600px; margin: 0 auto"></div>

    </div>
  </div>

  <!-- load scripts -->
  <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
  <script src='./src/src.js'></script>
  <script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sparklines/2.1.2/jquery.sparkline.min.js"></script>
  <script src="./data/southern_africa_ethnicity_murdock_1959.js"></script>
  <script src="./data/SouthAfrica_migration.js"></script>
  <script src="./data/Zimbabwe_migration.js"></script>

  <!-- begin javascript -->
  <script>
    var map = L.map('map', {
      center: [-20.00, 30.00], // You can hardcode the center of the map on specific coordinates
      zoom: 6 // You can hardcode the initial zoom level
    });

    // Add openstreet baselayer to the map (other options can be found here: https://leaflet-extras.github.io/leaflet-providers/preview/)
    var baseContemporary = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18, // Set the maximum zoom level
      minZoom: 2, // Set the minimum zoom level
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    });

    var base1922 = L.tileLayer('maptiles/political/{z}/{x}/{y}.png', {
      minZoom: 2,
      maxZoom: 7,
      tms: false,
      attribution: 'Generated by TilesXYZ'
    }).addTo(map); // Add the baselayer to the map

    // Add a scale bar
    L.control.scale({
      position: 'bottomright' // Position the scale bar at the bottom-right corner
    }).addTo(map);

    // Add functions to style the polygons by values
    function getColorGroup(d) {
      return d === "Barotseland" ? '#8ad77e' :
        d === "Bemba-Lamba" ? '#eb8a14' :
        d === "San" ? '#ef7890' :
        d === "Cushites, Southern" ? '#de350f' :
        d === "Fang-Dzem" ? '#e3ee8c' :
        d === "Khoekhoen" ? '#cb2a2d' :
        d === "Ila-Tonga" ? '#5fc0d3' :
        d === "Kasai" ? '#2f95cb' :
        d === "Kenya Highlands" ? '#5662df' :
        d === "Lower Congo" ? '#7cca55' :
        d === "Luba" ? '#4be3c5' :
        d === "Luguru-Zigula" ? '#8a44d5' :
        d === "Lunda" ? '#ebe280' :
        d === "Maravi" ? '#0e6ad9' :
        d === "Masai" ? '#b33dee' :
        d === "Mongo" ? '#c24cd7' :
        d === "Ngonde" ? '#eb558e' :
        d === "Nguni" ? '#cba02b' :
        d === "Nyamwezi" ? '#32d4d2' :
        d === "Nyika" ? '#70ca85' :
        d === "Rift" ? '#df6bdb' :
        d === "Riverain Congo" ? '#df5cc1' :
        d === "Rufiji" ? '#81e4aa' :
        d === "Rukwa" ? '#4d0ded' :
        d === "Shona-Thonga" ? '#89e88e' :
        d === "Sotho" ? '#53e4aa' :
        d === "Southwestern Bantu" ? '#98c864' :
        d === "Swahili" ? '#cc845a' :
        d === "West Lacustrine Bantu" ? '#9188eb' :
        d === "Western Angola" ? '#bae457' :
        d === "Yao-Makonde" ? '#5b81e8' :
        'rgba(0,0,0,0.0)';
    };

    // calculate arc width
    function calcWidth(val) {
      var width = Math.sqrt(val / Math.PI);
      return width * 1.25; // adjust 1.25 as a scale factor
    }; // end calcWidth() function

    // Define the current year selected by the slider
    var currentYear = $('.slider').val();

    // Define a migration layer for emigration from Malawi to South Africa
    var migrationLayer1 = new L.migrationLayer({
      map: map,
      data: southAfricaEmigration,
      pulseRadius: 30,
      pulseBorderWidth: 3,
      arcWidth: Math.round(calcWidth(Number(southAfricaEmigration[0]['emigrants_' + currentYear])) / 5),
      arcLabel: true,
      arcLabelFont: '10px sans-serif',
      maxWidth: 10
    });

    // Define a migration layer for emigration from Malawi to Zimbabwe
    var migrationLayer2 = new L.migrationLayer({
      map: map,
      data: zimbabweEmigration,
      pulseRadius: 30,
      pulseBorderWidth: 3,
      arcWidth: Math.round(calcWidth(Number(zimbabweEmigration[0]['emigrants_' + currentYear])) / 5),
      arcLabel: true,
      arcLabelFont: '10px sans-serif',
      maxWidth: 10
    });

    function hide() {
      migrationLayer1.hide();
      migrationLayer2.hide();
    }

    function show() {
      migrationLayer1.show();
      migrationLayer2.show();
    }

    // Declare a variable and make a leaflet geoJSON layer for the 1959 ethnicities polygons
    var ethnicities1959 = L.geoJSON(ethnicity1959, {

      // Style the layer
      style: function(feature) {
        return {
          color: "grey",
          weight: 1,
          opacity: 0.75,
          fillColor: getColorGroup(feature.properties.CultureGrp), // This returns the color assignments from the getColorGroup function above
          fillOpacity: 0.5
        };
      },

      // Restyle on mouseover, reset style on mouseout
      onEachFeature: function(feature, layer) {

        var props = layer.feature.properties; // Get the properties of the layer features

        // Bind a popup window to the layer
        layer.bindPopup("<h3 class='txt-bold'>" + props['NAME'] + "</h3>" +
          "<h4 class='txt-bold'>Cultural Group:" +
          "</h4><h5>" + props['CultureGrp'] +
          "</h5><h4 class='txt-bold'>Settlement Patterns: " + "</h4><h5>" + props['v30tr'] +
          "</h5><h4 class='txt-bold'>Community Size: " + "</h4><h5>" + props['v31tr'] +
          "</h5><h4 class='txt-bold'>Subsistence Economy: " + "</h4><h5>" + props['v42tr'] +
          "</h5><h4 class='txt-bold'>Class Stratification: " + "</h4><h5>" + props['v66tr'] +
          "</h5><h4 class='txt-bold'>Property Inheritance: " + "</h4><h5>" + props['v74tr'] +
          "</h5>"
        );

        layer.on({

          // Define what happens on mouseover
          mouseover: function(e) {
            var layer = e.target;
            layer.setStyle({
              color: '#3232FF',
              weight: 3,
              opacity: 0.75
            });
          },

          // Define what happens on mouseout
          mouseout: function(e) {

            // Reset the layer styles
            ethnicities1959.resetStyle(e.target);

          },

        });
      }

    }); // end ethnicities1959

    // Define the baselayers for the layer control
    var baselayers = {
      "Political Map, 1922": base1922,
      "Political Map, Contemporary": baseContemporary,
    };

    // Define the overlay layers for the layer control
    var overlays = {
      "Ethnic Groups, 1959": ethnicities1959,
      //"Emigration to South Africa": migrationLayer1,
      //"Emigration to Zimbabwe": migrationLayer2
    };

    // Send the layers to the layer control
    L.control.layers(baselayers, overlays, {
      collapsed: false,
    }).addTo(map);

    createTemporalLegend(currentYear);
    sequenceUI(migrationLayer1, migrationLayer2);
    updateArrow(migrationLayer1, migrationLayer2, currentYear);

    // add a temporal legend in sync with the UI slider
    function createTemporalLegend(currentYear) {

      var temporalLegend = L.control({
        position: 'bottomleft' // place the temporal legend at bottom left corner
      });

      // when added to the map
      temporalLegend.onAdd = function(map) {

        var div = L.DomUtil.get("temporal"); // get the style settings

        // disable the mouse events
        L.DomEvent.disableScrollPropagation(div);
        L.DomEvent.disableClickPropagation(div);

        return div; // return the style settings

      }

      $('#temporal span').html('Year: ' + currentYear); // change grade value to that currently selected by UI slider

      temporalLegend.addTo(map); // add the temporal legend to the map

    }; // end createTemporalLegend function

    // add a UI slider
    function sequenceUI(migrationLayer1, migrationLayer2) {

      // create Leaflet control for the slider
      var sliderControl = L.control({
        position: 'bottomleft'
      });

      // add controls to the slider
      sliderControl.onAdd = function(map) {

        var controls = L.DomUtil.get("slider");

        L.DomEvent.disableScrollPropagation(controls);
        L.DomEvent.disableClickPropagation(controls);

        return controls;

      }

      // add the control to the map
      sliderControl.addTo(map);

      $('.slider')
        .on('input change', function() {
          var currentYear = $(this).val(); // identifies the year selected
          createTemporalLegend(currentYear);
          updateArrow(migrationLayer1, migrationLayer2, currentYear);
        });

    }; // End sequenceUI function

    // Define updateArrow function
    function updateArrow(migrationLayer1, migrationLayer2, currentYear) {

      // Update width based on emigration from Malawi to South Africa
      var southAfricaData = migrationLayer1.options.data[0];
      var southAfricaEmigration = southAfricaData['emigrants_' + currentYear];
      var updateSouthAfricaWidth = Math.round(calcWidth(Number(southAfricaEmigration)) / 5);
      migrationLayer1.options.arcWidth = updateSouthAfricaWidth;
      // Set the migration arrow's zIndex high enough that it always appears over other layers
      migrationLayer1.container.style.zIndex = 1000;
      // Keep the migration arrow from capturing clicks and touches, so the user can access the layers beneath it
      migrationLayer1.container.style.pointerEvents = 'none';

      // Update width based on emigration from Malawi to Zimbabwe
      var zimbabweData = migrationLayer2.options.data[0];
      var zimbabweEmigration = zimbabweData['emigrants_' + currentYear];
      var updateZimbabweWidth = Math.round(calcWidth(Number(zimbabweEmigration)) / 5);
      migrationLayer2.options.arcWidth = updateZimbabweWidth;
      // Set the migration arrow's zIndex high enough that it always appears over other layers
      migrationLayer2.container.style.zIndex = 1000;
      // Keep the migration arrow from capturing clicks and touches, so the user can access the layers beneath it
      migrationLayer2.container.style.pointerEvents = 'none';

      // Add the Malawi to South Africa arrow to the map
      migrationLayer1.addTo(map);

      // Add the Malawi to Zimbabwe arrow to the map
      migrationLayer2.addTo(map);

      var malawiMarker = L.marker([-13.5, 34]).addTo(map);

      malawiMarker.bindPopup('<h4 class=txt-bold>Malawi, ' + currentYear + '</h4>' +
        '<h5>Emigration to South Africa: ' + southAfricaEmigration +
        '<br>Emgiration to Zimbabwe: ' + zimbabweEmigration + '</h5>');

      malawiMarker.on('mouseover', function(e) {
        this.openPopup();
      });
      malawiMarker.on('mouseout', function(e) {
        this.closePopup();
      });

    }; // End updateArrow function

  </script>

</body>

</html>
